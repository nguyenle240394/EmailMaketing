@page "/abc"
@model EmailMaketing.Web.Pages.ContentEmail.FormContentEmailModel
@section styles {
<abp-style src="/Pages/ContentEmail/FormContentEmail.css" />
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<div class="container">
    <form method="post">
        <div class="right-container">
            <div class="subject">
                <p>Subject line</p>
                <input id="inputsubject" type="text" name ="subject">
            </div>
            <div class="function">
                <div class="flex-column feature">
                    <p>Feature</p>
                    <span class="fa fa-star"></span>
                </div> 
                <div class="flex-column Schedule">
                    <p>Schedule Send Email</p>
                    <input type="datetime-local">
                </div>
                <div class="btn-function">
                    <button class="btn"><i class="fa fa-save"></i></button>
                    <button class="btn btn-delete" title="Delete Email" data-target="#myModal"><i class="fa fa-trash"></i></button>
                </div>
                <div class="flex-column preview">
                    <p>Preview</p>
                    <div class="items-preview">
                        <button class="btn btn-browser" title="Preview Email" data-target="#modalbrowser"><i class="fa fa-id-card"></i>Browser</button>
                        <button class="btn btnsend-email" title="Send test email" onclick="on(event)"><i class="fa fa-envelope"></i>Email</button>
                        <div class="preview-send">
                            <p>Send a test email to see how it will look in your email client.</p>
                            <input class="preview-email" type="text" />
                            <input class="preview-btn" type="submit" value="Send Preview" asp-page-handler="SendPreview"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content">
                <div style="display: flex; justify-content: space-between;">
                     <h6>Content</h6>
                    <span class="countwords border rounded" style="padding: 5px 10px; font-size: 13px; font-weight: 600">0 Words</span>
                </div>
                <div class="content-body">
                    <textarea id="text-runtime" placeholder="Write content your email here..."></textarea>
                </div>
            </div>
            <div class="email" style="margin-top: 10px">
                <div>
                    <label  for="FromEmail">From Email</label>
                    <div class="container1"> 
                          <div class="dropdown">
                            <div class="select">
                              <span>Select Email</span>
                              <i class="fa fa-chevron-left"></i>
                            </div>
                            <ul class="dropdown-menu">
                              <li id="male">Male</li>
                              <li id="female">Female</li>
                              <li id="female1">Female1</li>
                            </ul>
                          </div>
                    </div>
                </div>
                <div class="toemail">
                    <div>
                        <label>To Email</label>
                        <span class="recepients" data-target="#modalRecepients">Add Recepients</span>
                    </div>
                    <div id="to-recipients" style="padding: 10px;"></div>
                </div>
            </div>
            <div class="submit-form">
                <input type="submit" value="Send Immediately"/>
                <input type="submit" value="Send With Schedule"/>
            </div>
        </div>
        <div class="left-container">
            <h6>Email</h6>
            <div class="add-email" id="height">
                @foreach(var item in @Model.ContentEmail)
                {
                <div class="summary-email">
                    <div class="left">
                        <p class = "textchange">@item.Subject</p>
                        <div>
                            <img src="Images/alarmclock.png" style="width: 15px; height: 15px"/>
                            <span class = "datetime">@item.Time</span>
                        </div>
                    </div>
                    <div class="right">
                       <i class="fa fa-envelope"></i>
                       <p>DRAFT</p>
                    </div>
                </div>
                }
            </div>
            <input id="btnAddEmail" value="Add Email" type="button" onclick="AddEmail()"/>
        </div>
    </form>
</div>
<div id="overlay" onclick="off()"></div>  

@*modal delete*@
<div class="modal fade" id="myModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="width: 350px">
    <div class="modal-content col-xs-1" align="center">
        <h5 class="mt-4">Are you sure? </h5>
        <p>Once you delete this email,it cannot be recovered. </p>
        <div class="mb-4">
            <button type="button" class="btn btn-danger mr-5">Delete Email</button>
            <button type="button" class="btn btn-secondary" data-dismiss="myModal">Cancel</button>
        </div>
    </div>
  </div>
</div>
@*modal preview email*@
<div class="modal fade" id="modalbrowser" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="min-width: 650px !important">
    <div class="modal-content">
      <div class="modal-header" style="border: none">
        <h6 class="modal-title">Preview Email</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <div class="border rounded mb-2" style="height: 45px">

          </div>
          <textarea disabled class="border rounded" style="height: 450px; width: 100%; padding: 15px 20px"></textarea>
      </div>
    </div>
  </div>
</div>
@*recepients*@
<div class="modal fade" id="modalRecepients" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="min-width: 650px !important;">
    <div class="modal-content" style="height: 500px; padding: 25px 30px">
        <h5 class="mb-4">Update recipients</h5>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">List Recipients</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Select Maunal</a>
          </li>
        </ul>
        <div class="input-group mb-3 mt-3">
              <input type="text" class="form-control" placeholder="Filter lists" aria-label="Recipient's username" aria-describedby="basic-addon2">
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">Search</span>
              </div>
        </div>
        <div class="tab-content border rounded" id="myTabContent" style="padding: 15px">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            @for(int i = 0; i < 15; i++)
            {
                var Id = "list" + i;
                <div class="form-check border-bottom mb-3">
                  <input class="form-check-input" type="checkbox" value="" id="@i">
                  <label class="form-check-label" id="@Id" for="@i">List @i</label>
                </div>         
            }
          </div>
          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">

          </div>
        </div>
        <div class="mt-3 text-right">
            <button type="button" class="btn-toadd btn btn-primary" style="width: 150px">TO ADD</button>
            <button type="button" class="btn btn-secondary btn-cancelRecepients" >Cancel</button>
        </div>
    </div>
  </div>
</div>
<script>
    var MyArrayid = @Model.ContentEmail;
    //load data
    var count_elements = $('.summary-email').length;
    if (count_elements > 6) {
        $(".add-email").css('overflow-y', 'scroll')
    }
    //end load data
    if ($(".summary-email").length > 0) {
        $(".right-container").css('pointer-events', 'auto')
    }
    else {
        $(".right-container").css('pointer-events', 'none')
    }

    $('#inputsubject').on('input',function(e){
        var str = $("#inputsubject").val();
        $(".txt").text(str);
        if(str.length == 0){
            $(".txt").text("No Subject");
        }
     });

      $('#text-runtime').on('input',function(e){
        var str = $(this).val().length;
        $(".countwords").text(str + " Words")
     });


    var html = `<div class="summary-email">
                    <div class="left">
                        <p class = "textchange"></p>
                        <div>
                            <img src="Images/alarmclock.png" style="width: 15px; height: 15px"/>
                            <span class = "datetime"></span>
                        </div>
                    </div>
                    <div class="right">
                       <i class="fa fa-envelope"></i>
                       <p>DRAFT</p>
                    </div>
                </div>`
     function on(e)
     {
         e.preventDefault();
         $( ".preview-send" ).css("display", "block");
         var liststyle = document.getElementById("overlay");
         liststyle.style.display = "block";

     }

     $(".btn-delete").click(function(event) {
         event.preventDefault();
        $('#myModal').modal('show')
     });

     $(".btn-browser").click(function(event) {
         event.preventDefault();
        $('#modalbrowser').modal('show')
     });

     $(".modal .btn-secondary").click(function() {
        $('#myModal').modal('hide')
     });

     $(".close").click(function() {
        $('#modalbrowser').modal('hide')
     });

    $(".btn-cancelRecepients").click(function() {
        $('#modalRecepients').modal('hide')
    });

     $(".recepients").click(function() {
        $('#modalRecepients').modal('show')
         var count = $(".form-check").length;
         if(count >= 8){
             $(".tab-content").css('overflow-y', 'scroll');
         }
     });

     function off() 
     {
         $( ".preview-send" ).css("display", "none");
         $( "#overlay" ).css("display", "none");
     }

     $('#myTab a').on('click', function (e) {
          e.preventDefault()
          $(this).tab('show')
        })

     function previewEmail(e)
     {
         e.preventDefault();

         var txt = $("#text-runtime").val();

         $("#text-preview").text(txt);

         var overlay = document.getElementById("overlay");
         var textoverlay = document.getElementById("text");
         overlay.style.display = "block";
         overlay.style.backgroundColor = "rgba(0,0,0,0.4)";
         textoverlay.style.display = "block";
     }
     var index = 0;
     function AddEmail()
        {
            $.ajax({
                type: "POST",
                url: '@Url.Page("FormContentEmail","AddEmail")',
                dataType: 'json',
                data: {id: "1"},
                success: function(result) {
                    // $(".add-email .textchange").removeClass("txt");
                    // default text subject
                    $("#inputsubject").val("Write a compelling subject...");

                    // enable form email
                    $(".right-container").css('pointer-events', 'auto')
                    // add email
                    $(".add-email").append(html);
                    // get cout email
                    var count_elements = $('.summary-email').length;
                    if (count_elements > 6) {
                        $(".add-email").css('overflow-y', 'scroll')
                    }
                    //change text when edit title
                    $(".textchange").eq(count_elements - 1).text("Write a compelling subject...");
                    // get current datetime
                   
                    $(".datetime").eq(count_elements - 1).text(formatDatetime());
                    selectEmail(count_elements - 1);
                    $(".countwords").text("0 Words");
                },
                error: function() {
                    alert("Remove product error!");
                }
            });
        }


    $(".add-email").on("click", ".summary-email", function(){
        index = $(this).index();
        selectEmail(index);
        $.ajax({
                type: "POST",
                url: '@Url.Page("FormContentEmail","AddEmail")',
                dataType: 'json',
                data: {id: "1"},
                success: function(result) {
                },
                error: function() {
                    alert("Remove product error!");
                }
            });

    });

    function selectEmail(index){
        $(".add-email .textchange").removeClass("txt");
        $(".summary-email").css('background-color', 'white');
        $(".textchange").eq(index).addClass("txt");
        $(".summary-email").eq(index).css('background-color', '#F0F8FF');
    }

    function formatDatetime(){
            var currentTime = new Date();
            var dates = currentTime.getDate();
            var months = currentTime.getMonth();
            var years = currentTime.getFullYear()
            var hours = currentTime.getHours()
            var minutes = currentTime.getMinutes()

            if (minutes < 10)
                minutes = "0" + minutes;

            var suffix = "AM";
            if (hours >= 12) {
                suffix = "PM";
                hours = hours - 12;
            }
            if (hours == 0) {
                hours = 12;
            }
            var current_time =dates +"/" + months +"/" + years +"   "+ hours + ":" + minutes + " " + suffix;
        return current_time;
    }

// custom dropdown
$('.dropdown').click(function () {
        $(this).attr('tabindex', 1).focus();
        $(this).toggleClass('active');
        $(this).find('.dropdown-menu').slideToggle(300);
    });
    $('.email .dropdown').focusout(function () {
        $(this).removeClass('active');
        $(this).find('.dropdown-menu').slideUp(300);
    });
    $('.dropdown .dropdown-menu li').click(function () {
        $(this).parents('.email .dropdown').find('span').text($(this).text());
    });
/*End Dropdown Menu*/

// check checkbok is checked
$(".btn-toadd").click(function(){
    var i = 0;
    $(".form-check :checked").each(function() {
        var Id = "#list" + this.id;
        var gettext = $(Id).text();
        var html = `<p class ="item-email"> ${gettext} 
         <i class="fa fa-times"></i></p>`;
        $("#to-recipients").append(html);
    });
    if ($(".item-email").length >= 3) {
        $("#to-recipients").css('overflow-y', 'scroll');
    }
    $('#modalRecepients').modal('hide')
});

// delete email recipients

    $("#to-recipients").on("click", ".item-email", function(){
       var removeindex = $(this).index();
        $(".item-email").eq(removeindex).remove();
    });
</script>